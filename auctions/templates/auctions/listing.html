{% extends 'auctions/layout.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block body %}

<div class="row">
    <div class="col-sm-8 p-3">
        {% if not listing.image %}
            <img class='img-fluid' src="{% static 'auctions/default.jpg' %}" alt="{{ listing.title }}">
        {% else %}
            <img class='img-fluid' src="{{ listing.image }}" alt="{{ listing.title }}">
        {% endif %}
    </div>
    <div class="col-sm-4 p-3">
        <h3>{{ listing.title }}</h3>
        {% if not listing.closed and listing.user == request.user %}
            <form method="post">{% csrf_token %}
                <input type="submit" name="close" value="Close Listing">
            </form>
        {% endif %}
        <small>posted by: {{ listing.user.username }}</small><br><br>
        <small>Current price (started at {{ listing.starting_bid }} €):</small>
        <h3>{{ highest_bid.bid|default:listing.starting_bid }} €</h3>
        <small>{{ watchers }} user{{ watchers|pluralize }} watching this listing</small>
        <hr>
        {% if listing.closed %}

            <p>Listing closed</p>
            <p>winner: {{ highest_bid.user.username }}</p>

        {% else %}

            {% if user.is_authenticated %}

                <form method="post">{% csrf_token %}
                    <label for='bid'>Your offer:</label>
                    <p><input type='number' id='bid' name='bid' value="{{ listing.next_bid }}" step=0.01> €</p>
                    <div class="d-grid gap-2">
                        <p><input class="btn btn-primary" type="submit" value="Bid"></p>
                    </div>
                </form>
                <form method="post">{% csrf_token %}
                    <input type="submit" name="watchlist" value="Add to your Watchlist.">
                </form>

            {% else %}
                <small><a href="{% url 'login' %}">Log in</a> to place your bid or add to watchlist</small>
            {% endif %}

            {% endif %}
    </div>
  </div>
  <div class="row gap-3">
    <div class="col-sm p-3">
        <p>{{ listing.description }}</p>
    </div>
  </div>


<hr>
<p>Bids:</p>
<ul>
    {% for bid in bids %}
        <li>{{ bid.user.username }} - {{ bid.bid }} €</li>
    {% endfor %}
</ul>
<hr>
{% if user.is_authenticated %}
    <form method="post">{% csrf_token %}
        {{ comment_form|crispy }}
        <input class="btn btn-primary" type="submit" alue="Submit">
    </form>

{% else %}
    <p><a href="url 'login'">Log in</a> to add comments.</p>
{% endif %}

<hr>
{% for comment in comments %}
<div class="card">
  <div class="card-header">
    {{ comment.time|date:'d F Y' }}
  </div>
  <div class="card-body">
    <blockquote class="blockquote mb-0">
      <p>{{ comment.comment_content }}</p>
      <footer class="blockquote-footer">{{ comment.user.username }}</footer>
    </blockquote>
  </div>
</div><br>
{% endfor %}



{% endblock %}
